<div class="contenedor">
    <svg class="animated-line" viewBox="0 0 1000 200" preserveAspectRatio="none" fill="none" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <!-- Filtro de neón -->
        <filter id="neon-glow" x="-40%" y="-40%" width="180%" height="180%">
          <feGaussianBlur stdDeviation="3" result="blur"/>
          <feComposite in="blur" in2="SourceGraphic" operator="over"/>
        </filter>
        
        <!-- Gradiente para línea base -->
        <linearGradient id="line-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#00f2ff" stop-opacity="0.4"/>
          <stop offset="50%" stop-color="#008cff" stop-opacity="0.6"/>
          <stop offset="100%" stop-color="#00f2ff" stop-opacity="0.4"/>
        </linearGradient>
        
        <!-- Gradiente para línea animada -->
        <linearGradient id="energy-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#00f2ff" stop-opacity="0"/>
          <stop offset="15%" stop-color="#00f2ff" stop-opacity="0.8"/>
          <stop offset="85%" stop-color="#00f2ff" stop-opacity="0.8"/>
          <stop offset="100%" stop-color="#00f2ff" stop-opacity="0"/>
        </linearGradient>
      </defs>
      
      <!-- Línea base estática -->
      <path class="base-line" d="M 0 150 Q 500 50, 1000 150" 
            stroke="url(#line-gradient)" 
            stroke-width="0.6" 
            fill="transparent"/>
      
      <!-- Línea animada -->
      <path class="energy-line" d="M 0 150 Q 500 50, 1000 150" 
            stroke="url(#energy-gradient)" 
            stroke-width="2" 
            fill="transparent"
            filter="url(#neon-glow)"
            stroke-linecap="round"
            stroke-dasharray="200"
            stroke-dashoffset="0"/>
    </svg>
  
    <div class="login-container">
      <i class="fa-solid fa-key fa-2xl" style="color: #fff;"></i>
      
      <!-- Mensajes de éxito -->
      <div *ngIf="successMessage" class="success-message neon-message">
        <i class="fa-solid fa-circle-check success-icon"></i>
        <p>{{ successMessage }}</p>
      </div>
      
      <h3 class="etiquetas" *ngIf="!emailVerified && !passwordChanged">Recuperar Contraseña</h3>
      <h3 class="etiquetas" *ngIf="emailVerified && !passwordChanged">Nueva Contraseña</h3>
  
      <!-- Formulario para solicitar enlace de recuperación -->
      <form *ngIf="!emailVerified && !passwordChanged" (ngSubmit)="onSubmit()" [formGroup]="forgotPasswordForm">
        <input type="email" id="email" formControlName="email" placeholder="Ingresa tu correo">
        <div *ngIf="submitted && forgotPasswordForm.controls['email'].invalid" class="error-message">
          <i class="fa-solid fa-triangle-exclamation error-icon"></i>
          <span>Ingresa un correo válido.</span>
        </div>
  
        <button type="submit" [disabled]="loading">
          <span *ngIf="!loading">Enviar enlace</span>
          <span *ngIf="loading">
            <i class="fa fa-spinner fa-spin"></i> Cargando...
          </span>
        </button>
      </form>
  
      <!-- Mensaje de confirmación y espera -->
      <div *ngIf="waitingForVerification && !emailVerified" class="overlay">
        <div class="overlay-card neon-card">
          <h3>Correo enviado</h3>
          <p>Hemos enviado un enlace de recuperación a tu correo. Por favor, revisa tu bandeja de entrada.</p>
          <i class="fa-solid fa-envelope-circle-check envelope-icon"></i>
          <div class="loading-line">
            <div class="loading-line-progress"></div>
          </div>
        </div>
      </div>
  
      <!-- Formulario para cambiar la contraseña -->
      <form *ngIf="emailVerified && !passwordChanged" (ngSubmit)="changePassword()" [formGroup]="changePasswordForm">
        <input type="password" id="newPassword" formControlName="newPassword" placeholder="Nueva contraseña">
        <input type="password" id="confirmPassword" formControlName="confirmPassword" placeholder="Confirmar contraseña">
  
        <div *ngIf="submitted && changePasswordForm.invalid" class="error-message">
          <i class="fa-solid fa-triangle-exclamation error-icon"></i>
          <span *ngIf="changePasswordForm.hasError('mismatch')">Las contraseñas no coinciden.</span>
          <span *ngIf="changePasswordForm.controls['newPassword'].invalid">La contraseña debe tener al menos 6 caracteres.</span>
        </div>
  
        <button type="submit" [disabled]="loading">
          <span *ngIf="!loading">Cambiar contraseña</span>
          <span *ngIf="loading">
            <i class="fa fa-spinner fa-spin"></i> Cargando...
          </span>
        </button>
      </form>
  
      <a routerLink="/auth/login" class="forgot-password">
        <i class="fa-solid fa-arrow-left"></i> Volver al inicio de sesión
      </a>
    </div>
  </div>